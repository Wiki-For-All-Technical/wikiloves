-- ============================================
-- ALL WIKI LOVES CAMPAIGNS - INDIVIDUAL QUERIES (A-Z) - OPTIMIZED BY YEAR
-- ============================================
-- This file contains OPTIMIZED queries for EACH of the 77 campaigns
-- Each campaign has ONE query per year (2010-2025) for maximum speed
-- 
-- Key optimizations:
-- 1. Process one year at a time (smallest data chunk = fastest queries)
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- EXPECTED TIME: 5-30 seconds per year query
-- (Total per campaign: ~2-8 minutes for all 16 years, but you can run years in parallel)
-- 
-- USAGE:
-- 1. Find the queries for your campaign (search by name or Ctrl+F)
-- 2. Run each year query separately (or run multiple years in parallel tabs)
-- 3. Copy each entire query (from '-- ============================================' to 'ORDER BY year DESC, uploads DESC;')
-- 4. Run in Quarry (https://quarry.wmcloud.org/) - database: commonswiki_p
-- 5. Download results as JSON for each part
-- 6. Merge the two JSON files to get complete data for the campaign
-- 
-- OUTPUT FORMAT:
-- Each query returns: campaign_slug, campaign_name, year, country, uploads, uploaders, images_used, new_uploaders
-- ============================================

-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 1. WIKI LOVES AFRICA (africa) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Africa
-- Slug: africa
-- Category Pattern: Wiki_Loves_Africa
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: africa_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'africa' AS campaign_slug,
    'Wiki Loves Africa' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Africa%' OR cl.cl_to LIKE 'Wiki_Loves_Africa%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2010
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '1001000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2011
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '1001000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2012
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '1001000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2013
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '1001000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2014
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '1001000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2015
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '1001000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2016
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '1001000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2017
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '1001000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2018
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '1001000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2019
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '1001000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2020
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '1001000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2021
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '1001000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2022
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '1001000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2023
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '1001000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2024
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '1001000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 2. WIKI LOVES ANDES (andes) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Andes
-- Slug: andes
-- Category Pattern: Wiki_Loves_Andes
-- Year: 2025
-- Date Range: October 1st onwards (new uploaders counted from 10/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: andes_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'andes' AS campaign_slug,
    'Wiki Loves Andes' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 10/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '1001000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Andes%' OR cl.cl_to LIKE 'Wiki_Loves_Andes%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 3. WIKI LOVES ART BELGIUM (art-belgium) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Art Belgium
-- Slug: art-belgium
-- Category Pattern: Wiki_Loves_Art_Belgium
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: art-belgium_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'art-belgium' AS campaign_slug,
    'Wiki Loves Art Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Art_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Art_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 4. WIKI LOVES ASSAMESE CULTURE (assamese-culture) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Assamese Culture
-- Slug: assamese-culture
-- Category Pattern: Wiki_Loves_Assamese_Culture
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: assamese-culture_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'assamese-culture' AS campaign_slug,
    'Wiki Loves Assamese Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Assamese_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Assamese_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 5. WIKI LOVES BANGLA (bangla) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Bangla
-- Slug: bangla
-- Category Pattern: Wiki_Loves_Bangla
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: bangla_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'bangla' AS campaign_slug,
    'Wiki Loves Bangla' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Bangla%' OR cl.cl_to LIKE 'Wiki_Loves_Bangla%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2010
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0401000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2011
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0401000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2012
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0401000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2013
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0401000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2014
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0401000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2015
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0401000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2016
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0401000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2017
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0401000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2018
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0401000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2019
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0401000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2020
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0401000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2021
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0401000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2022
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0401000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2023
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0401000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2024
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0401000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 6. WIKI LOVES BIRDS (birds) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds
-- Slug: birds
-- Category Pattern: Wiki_Loves_Birds
-- Year: 2025
-- Date Range: April 1st onwards (new uploaders counted from 4/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds' AS campaign_slug,
    'Wiki Loves Birds' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 4/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0401000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds%' OR cl.cl_to LIKE 'Wiki_Loves_Birds%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 7. WIKI LOVES BIRDS INDIA (birds-india) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Birds India
-- Slug: birds-india
-- Category Pattern: Wiki_Loves_Birds_India
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: birds-india_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'birds-india' AS campaign_slug,
    'Wiki Loves Birds India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Birds_India%' OR cl.cl_to LIKE 'Wiki_Loves_Birds_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 8. WIKI LOVES BOTSWANA (botswana) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Botswana
-- Slug: botswana
-- Category Pattern: Wiki_Loves_Botswana
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: botswana_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'botswana' AS campaign_slug,
    'Wiki Loves Botswana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Botswana%' OR cl.cl_to LIKE 'Wiki_Loves_Botswana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 9. WIKI LOVES BUSTO ARSIZIO (busto-arsizio) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Busto Arsizio
-- Slug: busto-arsizio
-- Category Pattern: Wiki_Loves_Busto_Arsizio
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: busto-arsizio_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'busto-arsizio' AS campaign_slug,
    'Wiki Loves Busto Arsizio' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Busto_Arsizio%' OR cl.cl_to LIKE 'Wiki_Loves_Busto_Arsizio%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 10. WIKI LOVES CANOEING HAMBURG (canoeing-hamburg) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Canoeing Hamburg
-- Slug: canoeing-hamburg
-- Category Pattern: Wiki_Loves_Canoeing_Hamburg
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: canoeing-hamburg_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'canoeing-hamburg' AS campaign_slug,
    'Wiki Loves Canoeing Hamburg' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Canoeing_Hamburg%' OR cl.cl_to LIKE 'Wiki_Loves_Canoeing_Hamburg%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 11. WIKI LOVES CHILDREN (children) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Children
-- Slug: children
-- Category Pattern: Wiki_Loves_Children
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: children_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'children' AS campaign_slug,
    'Wiki Loves Children' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Children%' OR cl.cl_to LIKE 'Wiki_Loves_Children%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 12. WIKI LOVES CHINA (china) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves China
-- Slug: china
-- Category Pattern: Wiki_Loves_China
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: china_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'china' AS campaign_slug,
    'Wiki Loves China' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_China%' OR cl.cl_to LIKE 'Wiki_Loves_China%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 13. WIKI LOVES CLASSICS (classics) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Classics
-- Slug: classics
-- Category Pattern: Wiki_Loves_Classics
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: classics_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'classics' AS campaign_slug,
    'Wiki Loves Classics' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Classics%' OR cl.cl_to LIKE 'Wiki_Loves_Classics%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 14. WIKI LOVES COCKTAILS AT WIKICON (cocktails-at-wikicon) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cocktails At Wikicon
-- Slug: cocktails-at-wikicon
-- Category Pattern: Wiki_Loves_Cocktails_At_Wikicon
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cocktails-at-wikicon_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cocktails-at-wikicon' AS campaign_slug,
    'Wiki Loves Cocktails At Wikicon' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cocktails_At_Wikicon%' OR cl.cl_to LIKE 'Wiki_Loves_Cocktails_At_Wikicon%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 15. WIKI LOVES COSPLAY (cosplay) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cosplay
-- Slug: cosplay
-- Category Pattern: Wiki_Loves_Cosplay
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cosplay_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cosplay' AS campaign_slug,
    'Wiki Loves Cosplay' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cosplay%' OR cl.cl_to LIKE 'Wiki_Loves_Cosplay%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 16. WIKI LOVES CULTURA POPULAR BRASIL (cultura-popular-brasil) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Cultura Popular Brasil
-- Slug: cultura-popular-brasil
-- Category Pattern: Wiki_Loves_Cultura_Popular_Brasil
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: cultura-popular-brasil_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'cultura-popular-brasil' AS campaign_slug,
    'Wiki Loves Cultura Popular Brasil' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Cultura_Popular_Brasil%' OR cl.cl_to LIKE 'Wiki_Loves_Cultura_Popular_Brasil%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 17. WIKI LOVES CULTURE (culture) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Culture
-- Slug: culture
-- Category Pattern: Wiki_Loves_Culture
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: culture_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'culture' AS campaign_slug,
    'Wiki Loves Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 18. WIKI LOVES DENDERLAND (denderland) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Denderland
-- Slug: denderland
-- Category Pattern: Wiki_Loves_Denderland
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: denderland_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'denderland' AS campaign_slug,
    'Wiki Loves Denderland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Denderland%' OR cl.cl_to LIKE 'Wiki_Loves_Denderland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2010
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0501000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2011
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0501000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2012
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0501000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2013
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0501000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2014
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0501000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2015
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0501000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2016
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0501000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2017
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0501000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2018
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0501000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2019
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0501000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2020
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0501000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2021
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0501000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2022
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0501000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2023
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0501000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2024
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0501000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 19. WIKI LOVES EARTH (earth) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Earth
-- Slug: earth
-- Category Pattern: Wiki_Loves_Earth
-- Year: 2025
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: earth_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'earth' AS campaign_slug,
    'Wiki Loves Earth' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0501000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Earth%' OR cl.cl_to LIKE 'Wiki_Loves_Earth%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 20. WIKI LOVES EEMLAND (eemland) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Eemland
-- Slug: eemland
-- Category Pattern: Wiki_Loves_Eemland
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: eemland_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'eemland' AS campaign_slug,
    'Wiki Loves Eemland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Eemland%' OR cl.cl_to LIKE 'Wiki_Loves_Eemland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 21. WIKI LOVES EMIRATES (emirates) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Emirates
-- Slug: emirates
-- Category Pattern: Wiki_Loves_Emirates
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: emirates_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'emirates' AS campaign_slug,
    'Wiki Loves Emirates' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Emirates%' OR cl.cl_to LIKE 'Wiki_Loves_Emirates%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 22. WIKI LOVES EUROPRIDE (europride) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Europride
-- Slug: europride
-- Category Pattern: Wiki_Loves_Europride
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: europride_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'europride' AS campaign_slug,
    'Wiki Loves Europride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Europride%' OR cl.cl_to LIKE 'Wiki_Loves_Europride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 23. WIKI LOVES FALLES (falles) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Falles
-- Slug: falles
-- Category Pattern: Wiki_Loves_Falles
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: falles_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'falles' AS campaign_slug,
    'Wiki Loves Falles' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Falles%' OR cl.cl_to LIKE 'Wiki_Loves_Falles%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 24. WIKI LOVES FASHION (fashion) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fashion
-- Slug: fashion
-- Category Pattern: Wiki_Loves_Fashion
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fashion_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fashion' AS campaign_slug,
    'Wiki Loves Fashion' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fashion%' OR cl.cl_to LIKE 'Wiki_Loves_Fashion%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 25. WIKI LOVES FESTIVALS (festivals) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Festivals
-- Slug: festivals
-- Category Pattern: Wiki_Loves_Festivals
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: festivals_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'festivals' AS campaign_slug,
    'Wiki Loves Festivals' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Festivals%' OR cl.cl_to LIKE 'Wiki_Loves_Festivals%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2010
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0501000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2011
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0501000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2012
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0501000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2013
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0501000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2014
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0501000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2015
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0501000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2016
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0501000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2017
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0501000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2018
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0501000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2019
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0501000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2020
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0501000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2021
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0501000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2022
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0501000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2023
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0501000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2024
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0501000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 26. WIKI LOVES FILM (film) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Film
-- Slug: film
-- Category Pattern: Wiki_Loves_Film
-- Year: 2025
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: film_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'film' AS campaign_slug,
    'Wiki Loves Film' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0501000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Film%' OR cl.cl_to LIKE 'Wiki_Loves_Film%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 27. WIKI LOVES FIUMEFREDDO (fiumefreddo) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Fiumefreddo
-- Slug: fiumefreddo
-- Category Pattern: Wiki_Loves_Fiumefreddo
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: fiumefreddo_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'fiumefreddo' AS campaign_slug,
    'Wiki Loves Fiumefreddo' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Fiumefreddo%' OR cl.cl_to LIKE 'Wiki_Loves_Fiumefreddo%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2010
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0201000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2011
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0201000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2012
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0201000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2013
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0201000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2014
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0201000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2015
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0201000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2016
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0201000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2017
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0201000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2018
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0201000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2019
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0201000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2020
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0201000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2021
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0201000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2022
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0201000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2023
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0201000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2024
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0201000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 28. WIKI LOVES FOLK (folk) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folk
-- Slug: folk
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2025
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folk_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folk' AS campaign_slug,
    'Wiki Loves Folk' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0201000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2010
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0201000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2011
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0201000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2012
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0201000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2013
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0201000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2014
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0201000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2015
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0201000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2016
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0201000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2017
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0201000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2018
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0201000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2019
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0201000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2020
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0201000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2021
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0201000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2022
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0201000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2023
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0201000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2024
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0201000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 29. WIKI LOVES FOLKLORE (folklore) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Folklore
-- Slug: folklore
-- Category Pattern: Wiki_Loves_Folklore
-- Year: 2025
-- Date Range: February 1st onwards (new uploaders counted from 2/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: folklore_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'folklore' AS campaign_slug,
    'Wiki Loves Folklore' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 2/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0201000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Folklore%' OR cl.cl_to LIKE 'Wiki_Loves_Folklore%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2010
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0701000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2011
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0701000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2012
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0701000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2013
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0701000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2014
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0701000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2015
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0701000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2016
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0701000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2017
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0701000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2018
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0701000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2019
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0701000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2020
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0701000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2021
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0701000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2022
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0701000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2023
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0701000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2024
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0701000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 30. WIKI LOVES FOOD (food) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Food
-- Slug: food
-- Category Pattern: Wiki_Loves_Food
-- Year: 2025
-- Date Range: July 1st onwards (new uploaders counted from 7/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: food_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'food' AS campaign_slug,
    'Wiki Loves Food' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 7/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0701000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Food%' OR cl.cl_to LIKE 'Wiki_Loves_Food%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 31. WIKI LOVES FOR RURAL WORKS (for-rural-works) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves For Rural Works
-- Slug: for-rural-works
-- Category Pattern: Wiki_Loves_For_Rural_Works
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: for-rural-works_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'for-rural-works' AS campaign_slug,
    'Wiki Loves For Rural Works' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_For_Rural_Works%' OR cl.cl_to LIKE 'Wiki_Loves_For_Rural_Works%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 32. WIKI LOVES HERITAGE BELGIUM (heritage-belgium) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Belgium
-- Slug: heritage-belgium
-- Category Pattern: Wiki_Loves_Heritage_Belgium
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-belgium_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-belgium' AS campaign_slug,
    'Wiki Loves Heritage Belgium' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Belgium%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Belgium%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 33. WIKI LOVES HERITAGE GHANA (heritage-ghana) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Heritage Ghana
-- Slug: heritage-ghana
-- Category Pattern: Wiki_Loves_Heritage_Ghana
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: heritage-ghana_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'heritage-ghana' AS campaign_slug,
    'Wiki Loves Heritage Ghana' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Heritage_Ghana%' OR cl.cl_to LIKE 'Wiki_Loves_Heritage_Ghana%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 34. WIKI LOVES LIBRARIANS (librarians) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Librarians
-- Slug: librarians
-- Category Pattern: Wiki_Loves_Librarians
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: librarians_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'librarians' AS campaign_slug,
    'Wiki Loves Librarians' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Librarians%' OR cl.cl_to LIKE 'Wiki_Loves_Librarians%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 35. WIKI LOVES LIBRARIES SAAM (libraries-saam) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Libraries Saam
-- Slug: libraries-saam
-- Category Pattern: Wiki_Loves_Libraries_Saam
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: libraries-saam_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'libraries-saam' AS campaign_slug,
    'Wiki Loves Libraries Saam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Libraries_Saam%' OR cl.cl_to LIKE 'Wiki_Loves_Libraries_Saam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 36. WIKI LOVES LITTRATURE HATIENNE (littrature-hatienne) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Littrature Hatienne
-- Slug: littrature-hatienne
-- Category Pattern: Wiki_Loves_Littrature_Hatienne
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: littrature-hatienne_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'littrature-hatienne' AS campaign_slug,
    'Wiki Loves Littrature Hatienne' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Littrature_Hatienne%' OR cl.cl_to LIKE 'Wiki_Loves_Littrature_Hatienne%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 37. WIKI LOVES LIVING HERITAGE (living-heritage) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Living Heritage
-- Slug: living-heritage
-- Category Pattern: Wiki_Loves_Living_Heritage
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: living-heritage_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'living-heritage' AS campaign_slug,
    'Wiki Loves Living Heritage' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Living_Heritage%' OR cl.cl_to LIKE 'Wiki_Loves_Living_Heritage%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 38. WIKI LOVES LOVE (love) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Love
-- Slug: love
-- Category Pattern: Wiki_Loves_Love
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: love_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'love' AS campaign_slug,
    'Wiki Loves Love' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Love%' OR cl.cl_to LIKE 'Wiki_Loves_Love%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 39. WIKI LOVES MANGALURU (mangaluru) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mangaluru
-- Slug: mangaluru
-- Category Pattern: Wiki_Loves_Mangaluru
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mangaluru_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mangaluru' AS campaign_slug,
    'Wiki Loves Mangaluru' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mangaluru%' OR cl.cl_to LIKE 'Wiki_Loves_Mangaluru%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 40. WIKI LOVES MAPS (maps) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Maps
-- Slug: maps
-- Category Pattern: Wiki_Loves_Maps
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: maps_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'maps' AS campaign_slug,
    'Wiki Loves Maps' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Maps%' OR cl.cl_to LIKE 'Wiki_Loves_Maps%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 41. WIKI LOVES MEXICO (mexico) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mexico
-- Slug: mexico
-- Category Pattern: Wiki_Loves_Mexico
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mexico_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mexico' AS campaign_slug,
    'Wiki Loves Mexico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mexico%' OR cl.cl_to LIKE 'Wiki_Loves_Mexico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2010
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0901000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2011
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0901000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2012
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0901000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2013
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0901000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2014
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0901000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2015
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0901000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2016
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0901000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2017
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0901000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2018
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0901000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2019
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0901000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2020
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0901000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2021
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0901000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2022
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0901000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2023
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0901000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2024
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0901000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 42. WIKI LOVES MONUMENTS (monuments) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Monuments
-- Slug: monuments
-- Category Pattern: Wiki_Loves_Monuments
-- Year: 2025
-- Date Range: September 1st onwards (new uploaders counted from 9/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: monuments_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'monuments' AS campaign_slug,
    'Wiki Loves Monuments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 9/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0901000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Monuments%' OR cl.cl_to LIKE 'Wiki_Loves_Monuments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 43. WIKI LOVES MUSEUMS (museums) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums
-- Slug: museums
-- Category Pattern: Wiki_Loves_Museums
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums' AS campaign_slug,
    'Wiki Loves Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 44. WIKI LOVES MUSEUMS INDIA (museums-india) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Museums India
-- Slug: museums-india
-- Category Pattern: Wiki_Loves_Museums_India
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: museums-india_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'museums-india' AS campaign_slug,
    'Wiki Loves Museums India' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Museums_India%' OR cl.cl_to LIKE 'Wiki_Loves_Museums_India%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 45. WIKI LOVES MUZIRIS (muziris) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Muziris
-- Slug: muziris
-- Category Pattern: Wiki_Loves_Muziris
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: muziris_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'muziris' AS campaign_slug,
    'Wiki Loves Muziris' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Muziris%' OR cl.cl_to LIKE 'Wiki_Loves_Muziris%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 46. WIKI LOVES MXICO (mxico) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Mxico
-- Slug: mxico
-- Category Pattern: Wiki_Loves_Mxico
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: mxico_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'mxico' AS campaign_slug,
    'Wiki Loves Mxico' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Mxico%' OR cl.cl_to LIKE 'Wiki_Loves_Mxico%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 47. WIKI LOVES NAMIBIA (namibia) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Namibia
-- Slug: namibia
-- Category Pattern: Wiki_Loves_Namibia
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: namibia_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'namibia' AS campaign_slug,
    'Wiki Loves Namibia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Namibia%' OR cl.cl_to LIKE 'Wiki_Loves_Namibia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 48. WIKI LOVES NYC PARKS (nyc-parks) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Nyc Parks
-- Slug: nyc-parks
-- Category Pattern: Wiki_Loves_Nyc_Parks
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: nyc-parks_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'nyc-parks' AS campaign_slug,
    'Wiki Loves Nyc Parks' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Nyc_Parks%' OR cl.cl_to LIKE 'Wiki_Loves_Nyc_Parks%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 49. WIKI LOVES ONAM (onam) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Onam
-- Slug: onam
-- Category Pattern: Wiki_Loves_Onam
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: onam_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'onam' AS campaign_slug,
    'Wiki Loves Onam' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Onam%' OR cl.cl_to LIKE 'Wiki_Loves_Onam%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 50. WIKI LOVES PAJOTTENLAND ZENNEVALLEI (pajottenland-zennevallei) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pajottenland Zennevallei
-- Slug: pajottenland-zennevallei
-- Category Pattern: Wiki_Loves_Pajottenland_Zennevallei
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pajottenland-zennevallei_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pajottenland-zennevallei' AS campaign_slug,
    'Wiki Loves Pajottenland Zennevallei' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pajottenland_Zennevallei%' OR cl.cl_to LIKE 'Wiki_Loves_Pajottenland_Zennevallei%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 51. WIKI LOVES PARLIAMENTS (parliaments) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Parliaments
-- Slug: parliaments
-- Category Pattern: Wiki_Loves_Parliaments
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: parliaments_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'parliaments' AS campaign_slug,
    'Wiki Loves Parliaments' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Parliaments%' OR cl.cl_to LIKE 'Wiki_Loves_Parliaments%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 52. WIKI LOVES PESTO GENOVESE (pesto-genovese) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pesto Genovese
-- Slug: pesto-genovese
-- Category Pattern: Wiki_Loves_Pesto_Genovese
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pesto-genovese_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pesto-genovese' AS campaign_slug,
    'Wiki Loves Pesto Genovese' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pesto_Genovese%' OR cl.cl_to LIKE 'Wiki_Loves_Pesto_Genovese%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 53. WIKI LOVES PIEMONTE (piemonte) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Piemonte
-- Slug: piemonte
-- Category Pattern: Wiki_Loves_Piemonte
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: piemonte_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'piemonte' AS campaign_slug,
    'Wiki Loves Piemonte' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Piemonte%' OR cl.cl_to LIKE 'Wiki_Loves_Piemonte%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 54. WIKI LOVES PLANTS (plants) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Plants
-- Slug: plants
-- Category Pattern: Wiki_Loves_Plants
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: plants_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'plants' AS campaign_slug,
    'Wiki Loves Plants' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Plants%' OR cl.cl_to LIKE 'Wiki_Loves_Plants%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 55. WIKI LOVES PRIDE (pride) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Pride
-- Slug: pride
-- Category Pattern: Wiki_Loves_Pride
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: pride_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'pride' AS campaign_slug,
    'Wiki Loves Pride' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Pride%' OR cl.cl_to LIKE 'Wiki_Loves_Pride%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2010
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0501000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2011
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0501000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2012
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0501000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2013
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0501000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2014
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0501000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2015
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0501000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2016
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0501000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2017
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0501000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2018
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0501000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2019
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0501000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2020
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0501000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2021
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0501000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2022
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0501000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2023
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0501000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2024
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0501000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 56. WIKI LOVES PUBLIC ART (public-art) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Art
-- Slug: public-art
-- Category Pattern: Wiki_Loves_Public_Art
-- Year: 2025
-- Date Range: May 1st onwards (new uploaders counted from 5/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-art_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-art' AS campaign_slug,
    'Wiki Loves Public Art' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 5/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0501000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Art%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Art%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 57. WIKI LOVES PUBLIC SPACE (public-space) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Public Space
-- Slug: public-space
-- Category Pattern: Wiki_Loves_Public_Space
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: public-space_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'public-space' AS campaign_slug,
    'Wiki Loves Public Space' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Public_Space%' OR cl.cl_to LIKE 'Wiki_Loves_Public_Space%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 58. WIKI LOVES PUGLIA (puglia) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Puglia
-- Slug: puglia
-- Category Pattern: Wiki_Loves_Puglia
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: puglia_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'puglia' AS campaign_slug,
    'Wiki Loves Puglia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Puglia%' OR cl.cl_to LIKE 'Wiki_Loves_Puglia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 59. WIKI LOVES RAMADAN (ramadan) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ramadan
-- Slug: ramadan
-- Category Pattern: Wiki_Loves_Ramadan
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ramadan_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ramadan' AS campaign_slug,
    'Wiki Loves Ramadan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ramadan%' OR cl.cl_to LIKE 'Wiki_Loves_Ramadan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 60. WIKI LOVES RATHA JATRA (ratha-jatra) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Ratha Jatra
-- Slug: ratha-jatra
-- Category Pattern: Wiki_Loves_Ratha_Jatra
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: ratha-jatra_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'ratha-jatra' AS campaign_slug,
    'Wiki Loves Ratha Jatra' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Ratha_Jatra%' OR cl.cl_to LIKE 'Wiki_Loves_Ratha_Jatra%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 61. WIKI LOVES ROMANIA (romania) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Romania
-- Slug: romania
-- Category Pattern: Wiki_Loves_Romania
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: romania_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'romania' AS campaign_slug,
    'Wiki Loves Romania' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Romania%' OR cl.cl_to LIKE 'Wiki_Loves_Romania%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 62. WIKI LOVES SCHOOLS (schools) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Schools
-- Slug: schools
-- Category Pattern: Wiki_Loves_Schools
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: schools_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'schools' AS campaign_slug,
    'Wiki Loves Schools' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Schools%' OR cl.cl_to LIKE 'Wiki_Loves_Schools%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 63. WIKI LOVES SICILIA (sicilia) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sicilia
-- Slug: sicilia
-- Category Pattern: Wiki_Loves_Sicilia
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sicilia_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sicilia' AS campaign_slug,
    'Wiki Loves Sicilia' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sicilia%' OR cl.cl_to LIKE 'Wiki_Loves_Sicilia%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 64. WIKI LOVES SMALL MUSEUMS (small-museums) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Small Museums
-- Slug: small-museums
-- Category Pattern: Wiki_Loves_Small_Museums
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: small-museums_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'small-museums' AS campaign_slug,
    'Wiki Loves Small Museums' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Small_Museums%' OR cl.cl_to LIKE 'Wiki_Loves_Small_Museums%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 65. WIKI LOVES SPORT (sport) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sport
-- Slug: sport
-- Category Pattern: Wiki_Loves_Sport
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sport_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sport' AS campaign_slug,
    'Wiki Loves Sport' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sport%' OR cl.cl_to LIKE 'Wiki_Loves_Sport%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 66. WIKI LOVES STUFF (stuff) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Stuff
-- Slug: stuff
-- Category Pattern: Wiki_Loves_Stuff
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: stuff_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'stuff' AS campaign_slug,
    'Wiki Loves Stuff' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Stuff%' OR cl.cl_to LIKE 'Wiki_Loves_Stuff%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 67. WIKI LOVES SUDAN (sudan) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Sudan
-- Slug: sudan
-- Category Pattern: Wiki_Loves_Sudan
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: sudan_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'sudan' AS campaign_slug,
    'Wiki Loves Sudan' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Sudan%' OR cl.cl_to LIKE 'Wiki_Loves_Sudan%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 68. WIKI LOVES SWITZERLAND (switzerland) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Switzerland
-- Slug: switzerland
-- Category Pattern: Wiki_Loves_Switzerland
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: switzerland_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'switzerland' AS campaign_slug,
    'Wiki Loves Switzerland' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Switzerland%' OR cl.cl_to LIKE 'Wiki_Loves_Switzerland%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 69. WIKI LOVES TIRRENO COSENTINO (tirreno-cosentino) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tirreno Cosentino
-- Slug: tirreno-cosentino
-- Category Pattern: Wiki_Loves_Tirreno_Cosentino
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tirreno-cosentino_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tirreno-cosentino' AS campaign_slug,
    'Wiki Loves Tirreno Cosentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tirreno_Cosentino%' OR cl.cl_to LIKE 'Wiki_Loves_Tirreno_Cosentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 70. WIKI LOVES TRENTINO (trentino) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Trentino
-- Slug: trentino
-- Category Pattern: Wiki_Loves_Trentino
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: trentino_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'trentino' AS campaign_slug,
    'Wiki Loves Trentino' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Trentino%' OR cl.cl_to LIKE 'Wiki_Loves_Trentino%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 71. WIKI LOVES TRIBAL CULTURE (tribal-culture) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Tribal Culture
-- Slug: tribal-culture
-- Category Pattern: Wiki_Loves_Tribal_Culture
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: tribal-culture_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'tribal-culture' AS campaign_slug,
    'Wiki Loves Tribal Culture' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Tribal_Culture%' OR cl.cl_to LIKE 'Wiki_Loves_Tribal_Culture%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 72. WIKI LOVES VALLE DEL PRIMO PRESEPE (valle-del-primo-presepe) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Valle Del Primo Presepe
-- Slug: valle-del-primo-presepe
-- Category Pattern: Wiki_Loves_Valle_Del_Primo_Presepe
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: valle-del-primo-presepe_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'valle-del-primo-presepe' AS campaign_slug,
    'Wiki Loves Valle Del Primo Presepe' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Valle_Del_Primo_Presepe%' OR cl.cl_to LIKE 'Wiki_Loves_Valle_Del_Primo_Presepe%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 73. WIKI LOVES VILLAGES (villages) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Villages
-- Slug: villages
-- Category Pattern: Wiki_Loves_Villages
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: villages_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'villages' AS campaign_slug,
    'Wiki Loves Villages' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Villages%' OR cl.cl_to LIKE 'Wiki_Loves_Villages%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 74. WIKI LOVES VIZAG (vizag) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Vizag
-- Slug: vizag
-- Category Pattern: Wiki_Loves_Vizag
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: vizag_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'vizag' AS campaign_slug,
    'Wiki Loves Vizag' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Vizag%' OR cl.cl_to LIKE 'Wiki_Loves_Vizag%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 75. WIKI LOVES WAHRAN (wahran) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Wahran
-- Slug: wahran
-- Category Pattern: Wiki_Loves_Wahran
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: wahran_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'wahran' AS campaign_slug,
    'Wiki Loves Wahran' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Wahran%' OR cl.cl_to LIKE 'Wiki_Loves_Wahran%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2010
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '0301000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2011
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '0301000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2012
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '0301000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2013
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '0301000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2014
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '0301000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2015
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '0301000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2016
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '0301000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2017
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '0301000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2018
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '0301000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2019
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '0301000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2020
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '0301000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2021
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '0301000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2022
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '0301000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2023
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '0301000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2024
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '0301000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 76. WIKI LOVES WOMEN (women) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Loves Women
-- Slug: women
-- Category Pattern: Wiki_Loves_Women
-- Year: 2025
-- Date Range: March 1st onwards (new uploaders counted from 3/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: women_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'women' AS campaign_slug,
    'Wiki Loves Women' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 3/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '0301000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Images_from_Wiki_Loves_Women%' OR cl.cl_to LIKE 'Wiki_Loves_Women%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2010 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2010
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2010 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2010_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2010, '1101000000')
            AND u.user_registration <= CONCAT(2010, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2010
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2011 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2011
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2011 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2011_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2011, '1101000000')
            AND u.user_registration <= CONCAT(2011, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2011
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2012 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2012
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2012 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2012_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2012, '1101000000')
            AND u.user_registration <= CONCAT(2012, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2012
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2013 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2013
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2013 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2013_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2013, '1101000000')
            AND u.user_registration <= CONCAT(2013, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2013
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2014 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2014
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2014 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2014_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2014, '1101000000')
            AND u.user_registration <= CONCAT(2014, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2014
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2015 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2015
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2015 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2015_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2015, '1101000000')
            AND u.user_registration <= CONCAT(2015, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2015
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2016 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2016
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2016 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2016_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2016, '1101000000')
            AND u.user_registration <= CONCAT(2016, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2016
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2017 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2017
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2017 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2017_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2017, '1101000000')
            AND u.user_registration <= CONCAT(2017, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2017
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2018 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2018
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2018 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2018_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2018, '1101000000')
            AND u.user_registration <= CONCAT(2018, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2018
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2019 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2019
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2019 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2019_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2019, '1101000000')
            AND u.user_registration <= CONCAT(2019, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2019
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2020 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2020
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2020 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2020_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2020, '1101000000')
            AND u.user_registration <= CONCAT(2020, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2020
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2021 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2021
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2021 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2021_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2021, '1101000000')
            AND u.user_registration <= CONCAT(2021, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2021
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2022 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2022
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2022 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2022_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2022, '1101000000')
            AND u.user_registration <= CONCAT(2022, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2022
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2023 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2023
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2023 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2023_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2023, '1101000000')
            AND u.user_registration <= CONCAT(2023, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2023
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2024 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2024
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2024 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2024_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2024, '1101000000')
            AND u.user_registration <= CONCAT(2024, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2024
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- 77. WIKI SCIENCE COMPETITION (science) - YEAR 2025 - OPTIMIZED VERSION
-- ============================================
-- Campaign: Wiki Science Competition
-- Slug: science
-- Category Pattern: Wiki_Science_Competition
-- Year: 2025
-- Date Range: November 1st onwards (new uploaders counted from 11/1 through December)
-- Database: commonswiki_p
-- 
-- OPTIMIZATIONS:
-- 1. Process one year at a time for maximum speed
-- 2. Uses LEFT JOIN directly on imagelinks instead of EXISTS (much faster)
-- 3. Uses index-friendly LIKE patterns (fixed prefix)
-- 4. Simplified date calculations
-- 
-- This query returns year 2025 and countries for this campaign
-- Columns: year, country, uploads, uploaders, images_used, new_uploaders
-- 
-- SAVE AS: science_2025_multiyear.json (when downloading from Quarry)
-- EXPECTED TIME: 5-30 seconds (single year queries are much faster)
-- ============================================

SELECT 
    'science' AS campaign_slug,
    'Wiki Science Competition' AS campaign_name,
    CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) AS year,
    CASE 
        WHEN cl.cl_to LIKE '%_in_%' THEN
            REPLACE(SUBSTRING_INDEX(cl.cl_to, '_in_', -1), '_', ' ')
        ELSE 'Global'
    END AS country,
    COUNT(DISTINCT i.img_name) AS uploads,
    COUNT(DISTINCT a.actor_name) AS uploaders,
    COUNT(DISTINCT CASE 
        WHEN il_used.il_to IS NOT NULL THEN i.img_name 
    END) AS images_used,
    COUNT(DISTINCT CASE 
        -- Users registered on or after 11/1 of competition year (through end of year)
        WHEN u.user_registration >= CONCAT(2025, '1101000000')
            AND u.user_registration <= CONCAT(2025, '1231235959')
        THEN a.actor_name
    END) AS new_uploaders
FROM categorylinks cl
JOIN page p ON cl.cl_from = p.page_id
    AND p.page_namespace = 6 
    AND p.page_is_redirect = 0
JOIN image i ON i.img_name = p.page_title
JOIN actor_image a ON i.img_actor = a.actor_id
LEFT JOIN actor ON a.actor_id = actor.actor_id
LEFT JOIN user u ON actor.actor_user = u.user_id
LEFT JOIN imagelinks il_used ON il_used.il_to = p.page_id
WHERE cl.cl_type = 'file'
  AND (
    (cl.cl_to LIKE 'Wiki_Science_Competition%' OR cl.cl_to LIKE 'Images_from_Wiki_Science_Competition%' OR cl.cl_to LIKE '%WikiScience%')
  )
  AND cl.cl_to REGEXP '[0-9]{4}$'
  AND CAST(SUBSTRING_INDEX(cl.cl_to, '_', -1) AS UNSIGNED) = 2025
GROUP BY year, country
ORDER BY country, uploads DESC;



-- ============================================
-- SUMMARY
-- ============================================
-- Total campaigns: 77
-- Total queries: 1232 (2 per campaign)
-- Generated: OPTIMIZED individual queries (SPLIT by year range)
-- Sorted: Alphabetically by campaign name
-- Each query includes country-level breakdown
-- Year ranges: Part A (2010-2017), Part B (2018-2025)
-- ============================================
